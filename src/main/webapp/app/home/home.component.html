<section
  class="hero-section"
  [style.background-image]="
    'url(' +
    (bannerImageUrl ||
      'https://thuthuatnhanh.com/wp-content/uploads/2021/06/Hinh-anh-dan-PC-khung-dep-me-hon.jpg') +
    ')'
  "
>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1 class="hero-title">Welcome</h1>
    <p class="hero-subtitle">C·ª≠a h√†ng ƒëi·ªán t·ª≠ & c√¥ng ngh·ªá h√†ng ƒë·∫ßu Vi·ªát Nam</p>

    @if (account()?.authorities?.includes('ROLE_ADMIN')) {
      <div class="admin-notice">
        <fa-icon icon="shield-alt"></fa-icon>
        B·∫°n ƒëang ƒëƒÉng nh·∫≠p v·ªõi quy·ªÅn Admin
      </div>
      <div class="hero-actions">
        <a routerLink="/admin" class="btn btn-primary btn-lg">
          <fa-icon icon="cog"></fa-icon>
          Qu·∫£n l√Ω h·ªá th·ªëng
        </a>
        <a routerLink="/products" class="btn btn-outline-light btn-lg">
          <fa-icon icon="eye"></fa-icon>
          Xem c·ª≠a h√†ng
        </a>
      </div>
    } @else {
      <div class="hero-actions">
        <a routerLink="/products" class="btn btn-primary btn-lg">
          <fa-icon icon="shopping-cart"></fa-icon>
          Mua s·∫Øm ngay
        </a>
        <a routerLink="/cart" class="btn btn-outline-light btn-lg">
          <fa-icon icon="shopping-cart"></fa-icon>
          Xem gi·ªè h√†ng
        </a>
      </div>
    }
  </div>
</section>

<!-- Category Icons Section -->
<section class="category-icons">
  <h2 class="section-title">Danh M·ª•c</h2>
  <div class="icon-grid">
    @for (category of featuredCategories; track category.id) {
      <a
        [routerLink]="['/products']"
        [queryParams]="{ categorySlug: category.slug }"
        class="icon-card"
      >
        <div class="icon-wrapper">
          <fa-icon [icon]="getCategoryIcon(category.slug)" class="category-icon"></fa-icon>
        </div>
        <span class="icon-label">{{ category.name }}</span>
      </a>
    }
  </div>
</section>

<!-- S·∫£n ph·∫©m hot -->
<section class="best-sellers">
  <h2 class="section-title">üî• S·∫£n Ph·∫©m B√°n Ch·∫°y</h2>
  <div class="product-grid">
    @if (isLoading) {
      <p>ƒêang t·∫£i...</p>
    } @else if (bestSellerProducts.length === 0) {
      <p>Ch∆∞a c√≥ s·∫£n ph·∫©m b√°n ch·∫°y n√†o.</p>
    } @else {
      @for (product of bestSellerProducts; track product.id; let idx = $index) {
        <div class="product-card">
          <img
            [src]="getProxiedImageUrl(product.imageUrl)"
            [alt]="product.name"
            [attr.loading]="idx < 5 ? 'eager' : 'lazy'"
            (click)="viewProductDetail(product.id!)"
            (error)="onImageError($event)"
          />
          <div class="product-info">
            <h4 class="product-name" (click)="viewProductDetail(product.id!)">
              {{ product.name }}
            </h4>
            <p class="product-price">{{ formatPrice(product.price) }}</p>
            @if (product.quantity !== null && product.quantity !== undefined) {
              @if (product.quantity === 0) {
                <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
              } @else if (product.quantity < 10) {
                <p class="stock text-warning">
                  ‚ö†Ô∏è Ch·ªâ c√≤n {{ product.quantity }}
                </p>
              } @else {
                <p class="stock text-muted">C√≤n {{ product.quantity }}</p>
              }
            }
            <div class="product-buttons">
              <button
                type="button"
                (click)="toggleWishlist(product, $event)"
                class="btn-wishlist"
                [class.in-wishlist]="isInWishlist(product.id!)"
                title="Y√™u th√≠ch"
              >
                <fa-icon icon="heart"></fa-icon>
              </button>
              <button
                class="btn btn-sm btn-success flex-grow-1"
                (click)="addToCart(product)"
                [disabled]="product.quantity === 0"
              >
                <fa-icon icon="cart-plus"></fa-icon>
                {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m gi·ªè' }}
              </button>
            </div>
          </div>
        </div>
      }
    }
  </div>
</section>

<!-- S·∫£n ph·∫©m m·ªõi -->
<section class="new-products">
  <h2 class="section-title">‚ú® S·∫£n Ph·∫©m M·ªõi</h2>
  <div class="product-grid">
    @if (isLoading) {
      <p>ƒêang t·∫£i...</p>
    } @else if (newProducts.length === 0) {
      <p>ƒêang c·∫≠p nh·∫≠t s·∫£n ph·∫©m m·ªõi...</p>
    } @else {
      @for (product of newProducts; track product.id) {
        <div class="product-card">
          <div class="badge-new">NEW</div>
          <img
            [src]="getProxiedImageUrl(product.imageUrl)"
            [alt]="product.name"
            loading="lazy"
            (click)="viewProductDetail(product.id!)"
            (error)="onImageError($event)"
          />
          <div class="product-info">
            <h4 class="product-name" (click)="viewProductDetail(product.id!)">
              {{ product.name }}
            </h4>
            <p class="product-price">{{ formatPrice(product.price) }}</p>
            @if (product.quantity !== null && product.quantity !== undefined) {
              @if (product.quantity === 0) {
                <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
              } @else if (product.quantity < 10) {
                <p class="stock text-warning">
                  ‚ö†Ô∏è Ch·ªâ c√≤n {{ product.quantity }}
                </p>
              } @else {
                <p class="stock text-muted">Kho: {{ product.quantity }}</p>
              }
            }
            <div class="product-buttons">
              <button
                type="button"
                (click)="toggleWishlist(product, $event)"
                class="btn-wishlist"
                [class.in-wishlist]="isInWishlist(product.id!)"
                title="Y√™u th√≠ch"
              >
                <fa-icon icon="heart"></fa-icon>
              </button>
              <button
                class="btn btn-sm btn-success flex-grow-1"
                (click)="addToCart(product)"
                [disabled]="product.quantity === 0"
              >
                <fa-icon icon="cart-plus"></fa-icon>
                {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m gi·ªè' }}
              </button>
            </div>
          </div>
        </div>
      }
    }
  </div>
</section>

<!-- S·∫£n ph·∫©m ƒë√£ xem g·∫ßn ƒë√¢y -->
<section class="recently-viewed" *ngIf="recentlyViewedProducts.length > 0">
  <h2 class="section-title">üëÅÔ∏è S·∫£n Ph·∫©m ƒê√£ Xem G·∫ßn ƒê√¢y</h2>
  <div class="product-grid">
    @for (product of recentlyViewedProducts; track product.id) {
      <div class="product-card">
        <img
          [src]="getProxiedImageUrl(product.imageUrl)"
          [alt]="product.name"
          loading="lazy"
          (click)="viewProductDetail(product.id!)"
          (error)="onImageError($event)"
        />
        <div class="product-info">
          <h4 class="product-name" (click)="viewProductDetail(product.id!)">
            {{ product.name }}
          </h4>
          <p class="product-price">{{ formatPrice(product.price) }}</p>
          @if (product.quantity !== null && product.quantity !== undefined) {
            @if (product.quantity === 0) {
              <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
            } @else if (product.quantity < 10) {
              <p class="stock text-warning">
                ‚ö†Ô∏è Ch·ªâ c√≤n {{ product.quantity }}
              </p>
            } @else {
              <p class="stock text-muted">Kho: {{ product.quantity }}</p>
            }
          }
          <div class="product-buttons">
            <button
              type="button"
              (click)="toggleWishlist(product, $event)"
              class="btn-wishlist"
              [class.in-wishlist]="isInWishlist(product.id!)"
              title="Y√™u th√≠ch"
            >
              <fa-icon icon="heart"></fa-icon>
            </button>
            <button
              class="btn btn-sm btn-success flex-grow-1"
              (click)="addToCart(product)"
              [disabled]="product.quantity === 0"
            >
              <fa-icon icon="cart-plus"></fa-icon>
              {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m gi·ªè' }}
            </button>
          </div>
        </div>
      </div>
    }
  </div>
</section>

<!-- M·ª•c n·ªïi b·∫≠t-->
<section class="featured-categories">
  <div class="category-grid">
    @if (isLoading) {
      <p>ƒêang t·∫£i danh m·ª•c...</p>
    } @else if (featuredCategories.length === 0) {
      <p>Kh√¥ng c√≥ danh m·ª•c n·ªïi b·∫≠t n√†o.</p>
    } @else {
      @for (category of featuredCategories; track category.id) {
        <div class="category-card">
          <h3 class="category-title">{{ category.name }}</h3>
          <div class="product-grid">
            @if (category.products && category.products.length > 0) {
              @for (product of category.products; track product.id) {
              <div class="product-card">
                <img
                  [src]="getProxiedImageUrl(product.imageUrl)"
                  [alt]="product.name"
                  loading="lazy"
                  (click)="viewProductDetail(product.id!)"
                  (error)="onImageError($event)"
                />
                <div class="product-info">
                  <h4
                    class="product-name"
                    (click)="viewProductDetail(product.id!)"
                  >
                    {{ product.name }}
                  </h4>
                  <p class="product-price">{{ formatPrice(product.price) }}</p>
                  @if (
                    product.quantity !== null && product.quantity !== undefined
                  ) {
                    @if (product.quantity === 0) {
                      <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
                    } @else if (product.quantity < 10) {
                      <p class="stock text-warning">
                        ‚ö†Ô∏è C√≤n {{ product.quantity }}
                      </p>
                    } @else {
                      <p class="stock text-muted">
                        Kho: {{ product.quantity }}
                      </p>
                    }
                  }
                  <div class="product-buttons">
                    <button
                      type="button"
                      (click)="toggleWishlist(product, $event)"
                      class="btn-wishlist"
                      [class.in-wishlist]="isInWishlist(product.id!)"
                      title="Y√™u th√≠ch"
                    >
                      <fa-icon icon="heart"></fa-icon>
                    </button>
                    <button
                      class="btn btn-sm btn-success flex-grow-1"
                      (click)="addToCart(product)"
                      [disabled]="product.quantity === 0"
                    >
                      <fa-icon icon="cart-plus"></fa-icon>
                      {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m gi·ªè' }}
                    </button>
                  </div>
                </div>
              </div>
              }
            } @else {
              <p class="text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong danh m·ª•c n√†y.</p>
            }
          </div>
          <a
            [routerLink]="['/products']"
            [queryParams]="{ categorySlug: category.slug }"
            class="btn btn-primary btn-lg mt-3"
            >
            <fa-icon icon="arrow-right"></fa-icon>
            Xem th√™m
          </a>
        </div>
      }
    }
  </div>
</section>
