<section
  class="hero-section"
  [style.background-image]="
    'url(' +
    (bannerImageUrl ||
      'https://thuthuatnhanh.com/wp-content/uploads/2021/06/Hinh-anh-dan-PC-khung-dep-me-hon.jpg') +
    ')'
  "
>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1 class="hero-title">WelCome</h1>
    <p class="hero-subtitle">C·ª≠a h√†ng ƒëi·ªán t·ª≠ & c√¥ng ngh·ªá h√†ng ƒë·∫ßu Vi·ªát Nam</p>

    @if (account()?.authorities?.includes('ROLE_ADMIN')) {
      <div class="admin-notice">
        <fa-icon icon="shield-alt"></fa-icon>
        B·∫°n ƒëang ƒëƒÉng nh·∫≠p v·ªõi quy·ªÅn Admin
      </div>
      <div class="hero-actions">
        <a routerLink="/admin" class="btn btn-primary">
          <fa-icon icon="cog"></fa-icon>
          Qu·∫£n l√Ω h·ªá th·ªëng
        </a>
        <a routerLink="/products" class="btn btn-outline">
          <fa-icon icon="eye"></fa-icon>
          Xem c·ª≠a h√†ng
        </a>
      </div>
    } @else {
      <div class="hero-actions">
        <a routerLink="/products" class="btn btn-primary">
          <fa-icon icon="shopping-cart"></fa-icon>
          Mua s·∫Øm ngay
        </a>
        <a routerLink="/cart" class="btn btn-outline">
          <fa-icon icon="shopping-cart"></fa-icon>
          Xem gi·ªè h√†ng
        </a>
      </div>
    }
  </div>
</section>

<!-- Category Icons Section -->
<section class="category-icons">
  <h2 class="section-title">Danh M·ª•c</h2>
  <div class="icon-grid">
    @for (category of featuredCategories; track category.id) {
      <a
        [routerLink]="['/products']"
        [queryParams]="{ categorySlug: category.slug }"
        class="icon-card"
      >
        <div class="icon-wrapper">
          <fa-icon [icon]="['fas', 'tags']" class="category-icon"></fa-icon>
        </div>
        <span class="icon-label">{{ category.name }}</span>
      </a>
    }
  </div>
</section>

<!-- S·∫£n ph·∫©m hot -->
<section class="best-sellers">
  <h2 class="section-title">üî• S·∫£n Ph·∫©m B√°n Ch·∫°y</h2>
  <div class="product-grid">
    @if (bestSellerProducts.length === 0) {
      <p>ƒêang c·∫≠p nh·∫≠t...</p>
    } @else {
      @for (product of bestSellerProducts; track product.id; let idx = $index) {
        <div class="product-card">
          <img
            [src]="getProxiedImageUrl(product.imageUrl)"
            [alt]="product.name"
            [attr.loading]="idx < 4 ? 'eager' : 'lazy'"
            (click)="viewProductDetail(product.id)"
            (error)="onImageError($event)"
          />
          <div class="product-info">
            <h4 class="product-name" (click)="viewProductDetail(product.id)">
              {{ product.name }}
            </h4>
            <p class="product-price">{{ formatPrice(product.price) }}</p>
            @if (product.quantity !== null && product.quantity !== undefined) {
              @if (product.quantity === 0) {
                <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
              } @else if (product.quantity < 10) {
                <p class="stock text-warning">
                  ‚ö†Ô∏è Ch·ªâ c√≤n {{ product.quantity }}
                </p>
              } @else {
                <p class="stock text-muted">C√≤n {{ product.quantity }}</p>
              }
            }
            <div class="product-buttons">
              <button
                type="button"
                (click)="toggleWishlist(product, $event)"
                class="btn btn-sm"
                [class.btn-danger]="isInWishlist(product.id!)"
                [class.btn-outline-danger]="!isInWishlist(product.id!)"
              >
                <fa-icon icon="heart"></fa-icon>
              </button>
              <button
                class="btn btn-sm btn-success"
                (click)="addToCart(product)"
                [disabled]="product.quantity === 0"
              >
                {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m v√†o gi·ªè' }}
              </button>
            </div>
          </div>
        </div>
      }
    }
  </div>
</section>

<!-- S·∫£n ph·∫©m m·ªõi -->
<section class="new-products">
  <h2 class="section-title">‚ú® S·∫£n Ph·∫©m M·ªõi</h2>
  <div class="product-grid-compact">
    @if (newProducts.length === 0) {
      <p>ƒêang c·∫≠p nh·∫≠t s·∫£n ph·∫©m m·ªõi...</p>
    } @else {
      @for (product of newProducts; track product.id) {
        <div class="product-card-sm">
          <div class="badge-new">NEW</div>
          <img
            [src]="getProxiedImageUrl(product.imageUrl)"
            [alt]="product.name"
            loading="lazy"
            (click)="viewProductDetail(product.id)"
            (error)="onImageError($event)"
          />
          <div class="product-info">
            <h4 class="product-name" (click)="viewProductDetail(product.id)">
              {{ product.name }}
            </h4>
            <p class="product-price">{{ formatPrice(product.price) }}</p>
            @if (product.quantity !== null && product.quantity !== undefined) {
              @if (product.quantity === 0) {
                <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
              } @else if (product.quantity < 10) {
                <p class="stock text-warning">
                  ‚ö†Ô∏è Ch·ªâ c√≤n {{ product.quantity }}
                </p>
              } @else {
                <p class="stock text-muted">Kho: {{ product.quantity }}</p>
              }
            }
            <div class="product-buttons">
              <button
                type="button"
                (click)="toggleWishlist(product, $event)"
                class="btn btn-sm"
                [class.btn-danger]="isInWishlist(product.id!)"
                [class.btn-outline-danger]="!isInWishlist(product.id!)"
              >
                <fa-icon icon="heart"></fa-icon>
              </button>
              <button
                class="btn btn-sm btn-success"
                (click)="addToCart(product)"
                [disabled]="product.quantity === 0"
              >
                {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m v√†o gi·ªè' }}
              </button>
            </div>
          </div>
        </div>
      }
    }
  </div>
</section>

<!-- M·ª•c n·ªïi b·∫≠t-->
<section class="featured-categories">
  <div class="category-grid">
    @if (isLoading) {
      <p>ƒêang t·∫£i danh m·ª•c...</p>
    } @else if (featuredCategories.length === 0) {
      <p>Kh√¥ng c√≥ danh m·ª•c n·ªïi b·∫≠t n√†o.</p>
    } @else {
      @for (category of featuredCategories; track category.id) {
        <div class="category-card">
          <h3 class="category-title">{{ category.name }}</h3>
          <div class="product-preview-grid">
            @for (product of category.products?.slice(0, 8); track product.id) {
              <div class="product-card-sm">
                <img
                  [src]="getProxiedImageUrl(product.imageUrl)"
                  [alt]="product.name"
                  loading="lazy"
                  (click)="viewProductDetail(product.id)"
                  (error)="onImageError($event)"
                />
                <div class="product-info">
                  <h4
                    class="product-name"
                    (click)="viewProductDetail(product.id)"
                  >
                    {{ product.name }}
                  </h4>
                  <p class="product-price">{{ formatPrice(product.price) }}</p>
                  @if (
                    product.quantity !== null && product.quantity !== undefined
                  ) {
                    @if (product.quantity === 0) {
                      <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
                    } @else if (product.quantity < 10) {
                      <p class="stock text-warning">
                        ‚ö†Ô∏è C√≤n {{ product.quantity }}
                      </p>
                    } @else {
                      <p class="stock text-muted">
                        Kho: {{ product.quantity }}
                      </p>
                    }
                  }
                  <div class="product-buttons">
                    <button
                      type="button"
                      (click)="toggleWishlist(product, $event)"
                      class="btn btn-sm"
                      [class.btn-danger]="isInWishlist(product.id!)"
                      [class.btn-outline-danger]="!isInWishlist(product.id!)"
                    >
                      <fa-icon icon="heart"></fa-icon>
                    </button>
                    <button
                      class="btn btn-sm btn-success"
                      (click)="addToCart(product)"
                      [disabled]="product.quantity === 0"
                    >
                      {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m v√†o gi·ªè' }}
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
          <a
            [routerLink]="['/products']"
            [queryParams]="{ categorySlug: category.slug }"
            class="view-all-link"
            >Xem th√™m ‚Üí</a
          >
        </div>
      }
    }
  </div>
</section>
