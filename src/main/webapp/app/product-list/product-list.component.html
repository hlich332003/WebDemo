<h1>üõçÔ∏è T·∫•t c·∫£ S·∫£n ph·∫©m</h1>

<div class="filter-section">
  <div class="search-wrapper">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="onSearchTermChange($event)"
      placeholder="üîç T√¨m ki·∫øm ..."
      class="search-input"
    />
    @if (isSearching) {
      <span class="search-loading" title="ƒêang t√¨m ki·∫øm...">‚è≥</span>
    }
    @if (searchTerm) {
      <button
        class="clear-search-btn"
        (click)="clearSearch()"
        type="button"
        title="X√≥a t√¨m ki·∫øm"
      >
        ‚úñÔ∏è
      </button>
    }
  </div>

  <!-- Category filter -->
  <div class="category-wrapper">
    <select
      [(ngModel)]="selectedCategorySlug"
      (change)="onCategoryChange()"
      class="category-select"
    >
      <option value="all">üè∑Ô∏è T·∫•t c·∫£</option>
      @for (category of categories; track category.id) {
        <option [value]="category.slug">{{ category.name }}</option>
      }
    </select>
  </div>
</div>

<!-- Hi·ªÉn th·ªã s·ªë k·∫øt qu·∫£ t√¨m ki·∫øm -->
@if (searchTerm || selectedCategorySlug !== 'all') {
  <div class="result-info">
    @if (isSearching || isLoading) {
      <p class="searching-text">‚è≥ ƒêang t√¨m ki·∫øm...</p>
    } @else {
      <p class="result-count">
        T√¨m th·∫•y <strong>{{ totalItems }}</strong> s·∫£n ph·∫©m
        @if (searchTerm) {
          <span
            >cho t·ª´ kh√≥a "<strong>{{ searchTerm }}</strong
            >"</span
          >
        }
        @if (selectedCategorySlug !== 'all') {
          <span class="category-badge">üè∑Ô∏è {{ getCategoryName() }}</span>
        }
        <button class="btn-clear-all" (click)="clearAllFilters()" type="button">
          ‚úñÔ∏è X√≥a b·ªô l·ªçc
        </button>
      </p>
    }
  </div>
}

<h2 class="section-title">T·∫•t c·∫£ s·∫£n ph·∫©m</h2>
<div class="products-grid">
  @if (isLoading) {
    <p>ƒêang t·∫£i s·∫£n ph·∫©m...</p>
  } @else if (filteredProducts.length === 0) {
    <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>
  } @else {
    @for (product of filteredProducts; track product.id) {
      <div class="product-card" (click)="viewProductDetail(product.id)">
        <img
          [jhiLazyLoad]="getProxiedImageUrl(product.imageUrl)"
          [alt]="product.name"
          (error)="onImageError($event)"
        />
        <div class="product-info">
          <h3>{{ product.name }}</h3>
          <p class="price">{{ formatPrice(product.price) }}</p>
          @if (product.quantity !== null && product.quantity !== undefined) {
            @if (product.quantity === 0) {
              <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
            } @else if (product.quantity < 10) {
              <p class="stock text-warning">
                ‚ö†Ô∏è Ch·ªâ c√≤n {{ product.quantity }} s·∫£n ph·∫©m
              </p>
            } @else {
              <p class="stock text-muted">
                C√≤n {{ product.quantity }} s·∫£n ph·∫©m
              </p>
            }
          }
          <div class="product-buttons">
            <button
              type="button"
              (click)="toggleWishlist(product, $event)"
              class="btn btn-sm"
              [class.btn-danger]="isInWishlist(product.id!)"
              [class.btn-outline-danger]="!isInWishlist(product.id!)"
            >
              <fa-icon icon="heart"></fa-icon>
            </button>
            <button
              (click)="addToCart(product); $event.stopPropagation()"
              [disabled]="product.quantity === 0"
              class="btn btn-sm btn-primary"
            >
              {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m v√†o gi·ªè' }}
            </button>
          </div>
        </div>
      </div>
    }
    <!-- ƒê√≥ng kh·ªëi @for -->
  }
  <!-- ƒê√≥ng kh·ªëi @else if (filteredProducts.length === 0) -->
</div>

<!-- Ph√¢n trang -->
@if (filteredProducts.length > 0) {
  <div class="d-flex justify-content-center">
    <jhi-item-count [params]="{ page, totalItems, itemsPerPage }" />
  </div>

  <div class="d-flex justify-content-center">
    <ngb-pagination
      [collectionSize]="totalItems"
      [(page)]="page"
      [pageSize]="itemsPerPage"
      [maxSize]="5"
      [rotate]="true"
      [boundaryLinks]="true"
      (pageChange)="transition()"
    ></ngb-pagination>
  </div>
}
