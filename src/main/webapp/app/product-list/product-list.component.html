<h1>üõçÔ∏è T·∫•t c·∫£ S·∫£n ph·∫©m</h1>

<div class="filter-section">
  <!-- Search box v·ªõi clear button -->
  <div class="search-wrapper">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchTermChange($event)"
      placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..."
      class="search-input"
    />
    @if (searchTerm) {
      <button class="clear-search-btn" (click)="clearSearch()" title="X√≥a t√¨m ki·∫øm">‚úï</button>
    }
    @if (isSearching) {
      <span class="search-loading">üîÑ</span>
    }
  </div>

  <!-- Category filter -->
  <select [(ngModel)]="selectedCategorySlug" (change)="onCategoryChange()">
    <option value="all">T·∫•t c·∫£ danh m·ª•c</option>
    @for (category of categories; track category.id) {
      <option [value]="category.slug">{{ category.name }}</option>
    }
  </select>
</div>

<!-- Hi·ªÉn th·ªã s·ªë k·∫øt qu·∫£ -->
@if (searchTerm || selectedCategorySlug !== 'all') {
  <p class="result-count">
    @if (isSearching) {
      ƒêang t√¨m ki·∫øm...
    } @else {
      T√¨m th·∫•y <strong>{{ totalItems }}</strong> s·∫£n ph·∫©m
      @if (searchTerm) {
        cho "<strong>{{ searchTerm }}</strong
        >"
      }
    }
  </p>
}

<h2 class="section-title">T·∫•t c·∫£ s·∫£n ph·∫©m</h2>
<div class="products-grid">
  @if (isLoading) {
    <p>ƒêang t·∫£i s·∫£n ph·∫©m...</p>
  } @else if (filteredProducts.length === 0) {
    <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>
  } @else {
    @for (product of filteredProducts; track product.id) {
      <div class="product-card" (click)="viewProductDetail(product.id)">
        <img
          [src]="product.imageUrl || 'content/images/default-product.svg'"
          [alt]="product.name"
          loading="lazy"
          (error)="onImageError($event)"
        />
        <div class="product-info">
          <h3>{{ product.name }}</h3>
          <p class="price">{{ formatPrice(product.price) }}</p>
          @if (product.quantity !== null && product.quantity !== undefined) {
            @if (product.quantity === 0) {
              <p class="stock text-danger fw-bold">‚ùå H·∫øt h√†ng</p>
            } @else if (product.quantity < 10) {
              <p class="stock text-warning">‚ö†Ô∏è Ch·ªâ c√≤n {{ product.quantity }} s·∫£n ph·∫©m</p>
            } @else {
              <p class="stock text-muted">C√≤n {{ product.quantity }} s·∫£n ph·∫©m</p>
            }
          }
          <div class="product-buttons">
            <button (click)="addToCart(product); $event.stopPropagation()" [disabled]="product.quantity === 0" class="add-to-cart-btn">
              {{ product.quantity === 0 ? 'H·∫øt h√†ng' : 'Th√™m v√†o gi·ªè' }}
            </button>
          </div>
        </div>
      </div>
    }
    <!-- ƒê√≥ng kh·ªëi @for -->
  }
  <!-- ƒê√≥ng kh·ªëi @else if (filteredProducts.length === 0) -->
</div>

<!-- Ph√¢n trang -->
@if (filteredProducts.length > 0) {
  <div class="d-flex justify-content-center">
    <jhi-item-count [params]="{ page, totalItems, itemsPerPage }" />
  </div>

  <div class="d-flex justify-content-center">
    <ngb-pagination
      [collectionSize]="totalItems"
      [(page)]="page"
      [pageSize]="itemsPerPage"
      [maxSize]="5"
      [rotate]="true"
      [boundaryLinks]="true"
      (pageChange)="transition()"
    ></ngb-pagination>
  </div>
}
