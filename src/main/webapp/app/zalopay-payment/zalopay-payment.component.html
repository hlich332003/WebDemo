<div class="zalopay-payment-container">
  <div class="payment-header">
    <h2>💳 Thanh toán qua ZaloPay</h2>
  </div>
  <!-- Loading State -->
  <div *ngIf="paymentStatus === 'loading'" class="payment-status loading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Đang tải...</span>
    </div>
    <p class="mt-3">Đang tạo đơn thanh toán...</p>
  </div>
  <!-- Pending Payment State -->
  <div *ngIf="paymentStatus === 'pending'" class="payment-status pending">
    <div class="qr-container">
      <div class="qr-frame">
        <iframe *ngIf="safePaymentUrl" [src]="safePaymentUrl" frameborder="0" class="qr-iframe"></iframe>
      </div>
      <div class="qr-instructions">
        <h4>📱 Hướng dẫn thanh toán</h4>
        <ol>
          <li>Mở ứng dụng ZaloPay trên điện thoại</li>
          <li>Chọn "Quét mã QR"</li>
          <li>Quét mã QR phía trên để thanh toán</li>
          <li>Xác nhận thanh toán trên điện thoại</li>
        </ol>
        <button type="button" class="btn btn-primary mt-3" (click)="openPaymentInNewWindow()">
          <fa-icon icon="external-link-alt"></fa-icon> Mở trong cửa sổ mới
        </button>
      </div>
    </div>
    <div class="payment-waiting">
      <div class="spinner-grow text-warning" role="status">
        <span class="visually-hidden">Đang chờ...</span>
      </div>
      <p class="mt-3">
        <strong>Đang chờ thanh toán...</strong><br />
        <small>Thời gian đã trôi qua: {{ getTimeElapsed() }}s</small>
      </p>
      <div class="alert alert-info mt-3">
        <fa-icon icon="info-circle"></fa-icon>
        Vui lòng không đóng trang này cho đến khi thanh toán hoàn tất
      </div>
    </div>
  </div>
  <!-- Success State -->
  <div *ngIf="paymentStatus === 'success'" class="payment-status success">
    <div class="success-icon">
      <fa-icon icon="check-circle" size="4x"></fa-icon>
    </div>
    <h3>✅ Thanh toán thành công!</h3>
    <p>Đơn hàng của bạn đã được thanh toán thành công qua ZaloPay.</p>
    <p class="text-muted">Mã giao dịch: {{ appTransId }}</p>
  </div>
  <!-- Failed State -->
  <div *ngIf="paymentStatus === 'failed'" class="payment-status failed">
    <div class="error-icon">
      <fa-icon icon="times-circle" size="4x"></fa-icon>
    </div>
    <h3>❌ Thanh toán thất bại</h3>
    <p class="error-text">{{ errorMessage }}</p>
    <button type="button" class="btn btn-warning mt-3" (click)="retryPayment()"><fa-icon icon="redo"></fa-icon> Thử lại</button>
  </div>
  <!-- Timeout State -->
  <div *ngIf="paymentStatus === 'timeout'" class="payment-status timeout">
    <div class="warning-icon">
      <fa-icon icon="clock" size="4x"></fa-icon>
    </div>
    <h3>⏰ Hết thời gian thanh toán</h3>
    <p>Phiên thanh toán đã hết hạn. Vui lòng thử lại.</p>
    <button type="button" class="btn btn-primary mt-3" (click)="retryPayment()"><fa-icon icon="redo"></fa-icon> Tạo đơn mới</button>
  </div>
</div>
