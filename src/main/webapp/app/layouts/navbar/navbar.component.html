<nav data-cy="navbar" class="navbar navbar-dark navbar-expand-md bg-dark">
  <div class="container-fluid">
    <div class="top-row">
      <a
        class="navbar-brand logo"
        [routerLink]="account()?.authorities?.includes('ROLE_ADMIN') ? '/admin' : '/'"
        (click)="collapseNavbar()"
      >
        <span class="logo-img"></span>
        <span class="navbar-title">WebDemo</span>
        <span class="navbar-version">{{ version }}</span>
      </a>

      <!-- Thanh t√¨m ki·∫øm -->
      <div class="search-container flex-grow-1">
        <form class="search-form d-flex align-items-center" (ngSubmit)="search()">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            name="searchTerm"
            placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..."
            class="search-input form-control me-2"
            (input)="onSearchInput($event)"
          />

          <!-- Clear button -->
          <button type="button" class="btn btn-outline-light me-2" *ngIf="searchTerm" (click)="clearSearch()" aria-label="Clear search">
            <fa-icon icon="times"></fa-icon>
          </button>

          <!-- Spinner while searching -->
          <button type="submit" class="btn btn-primary" [disabled]="isSearching" aria-label="Search">
            <fa-icon *ngIf="!isSearching" icon="search"></fa-icon>
            <span *ngIf="isSearching" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </button>
        </form>
      </div>

      <div class="navbar-collapse collapse d-lg-block" id="navbarResponsive" [ngbCollapse]="isNavbarCollapsed()">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <a class="nav-link" [routerLink]="account()?.authorities?.includes('ROLE_ADMIN') ? '/admin' : '/'" (click)="collapseNavbar()">
              <span>
                <fa-icon icon="home"></fa-icon>
                <span>Trang ch·ªß</span>
              </span>
            </a>
          </li>
          <!-- N√∫t gi·ªè h√†ng (·∫©n cho admin) -->
          <li *ngIf="showCart()" class="nav-item" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <a class="nav-link" routerLink="/cart" (click)="collapseNavbar()">
              <span>
                <fa-icon icon="cart-shopping"></fa-icon>
                <span>Gi·ªè h√†ng</span>
                @if (((cartItemCount$ | async) ?? 0) > 0) {
                  <span class="badge bg-danger rounded-pill">{{ cartItemCount$ | async }}</span>
                }
              </span>
            </a>
          </li>
          <!-- jhipster-needle-add-element-to-menu - JHipster will add new menu items here -->
          <li
            *jhiHasAnyAuthority="'ROLE_ADMIN'"
            ngbDropdown
            class="nav-item dropdown pointer"
            display="dynamic"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            <a class="nav-link dropdown-toggle" ngbDropdownToggle href="javascript:void(0);" id="entity-menu" data-cy="entity">
              <span>
                <fa-icon icon="th-list"></fa-icon>
                <span>Qu·∫£n l√Ω</span>
              </span>
            </a>
            <ul class="dropdown-menu" ngbDropdownMenu aria-labelledby="entity-menu">
              <li>
                <a class="dropdown-item" routerLink="/admin/product-management" routerLinkActive="active" (click)="collapseNavbar()">
                  <fa-icon icon="box-open" [fixedWidth]="true"></fa-icon>
                  <span>Qu·∫£n l√Ω s·∫£n ph·∫©m</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" routerLink="/admin/order-management" routerLinkActive="active" (click)="collapseNavbar()">
                  <fa-icon icon="receipt" [fixedWidth]="true"></fa-icon>
                  <span>Qu·∫£n l√Ω ƒë∆°n h√†ng</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" routerLink="/admin/user-management" routerLinkActive="active" (click)="collapseNavbar()">
                  <span>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span>
                </a>
              </li>
              <!-- jhipster-needle-add-entity-to-menu - JHipster will add entities to the menu here -->
            </ul>
          </li>
          <li
            ngbDropdown
            class="nav-item dropdown pointer"
            display="dynamic"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            @let accountRef = account();
            <a class="nav-link dropdown-toggle" ngbDropdownToggle href="javascript:void(0);" id="account-menu" data-cy="accountMenu">
              @if (!accountRef?.imageUrl) {
                <span>
                  <fa-icon icon="user"></fa-icon>
                  <span>T√†i kho·∫£n</span>
                </span>
              } @else {
                <span>
                  <img [src]="accountRef!.imageUrl" class="profile-image rounded-circle" alt="Avatar" />
                </span>
              }
            </a>
            <ul class="dropdown-menu" ngbDropdownMenu aria-labelledby="account-menu">
              @if (accountRef !== null) {
                <li *jhiHasAnyAuthority="'ROLE_USER'">
                  @if (!accountRef.authorities.includes('ROLE_ADMIN')) {
                    <a
                      class="dropdown-item"
                      routerLink="/account/my-orders"
                      routerLinkActive="active"
                      (click)="collapseNavbar()"
                      data-cy="myOrders"
                    >
                      <fa-icon icon="receipt" [fixedWidth]="true"></fa-icon>
                      <span>ƒê∆°n h√†ng c·ªßa t√¥i</span>
                    </a>
                  }
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    routerLink="/account/settings"
                    routerLinkActive="active"
                    (click)="collapseNavbar()"
                    data-cy="settings"
                  >
                    <fa-icon icon="wrench" [fixedWidth]="true"></fa-icon>
                    <span>C√†i ƒë·∫∑t</span>
                  </a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    routerLink="/account/password"
                    routerLinkActive="active"
                    (click)="collapseNavbar()"
                    data-cy="passwordItem"
                  >
                    <fa-icon icon="lock" [fixedWidth]="true"></fa-icon>
                    <span>M·∫≠t kh·∫©u</span>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" (click)="logout()" id="logout" data-cy="logout">
                    <fa-icon icon="sign-out-alt" [fixedWidth]="true"></fa-icon>
                    <span>ƒêƒÉng xu·∫•t</span>
                  </a>
                </li>
              } @else {
                <li>
                  <a class="dropdown-item" (click)="login()" id="login" data-cy="login">
                    <fa-icon icon="sign-in-alt" [fixedWidth]="true"></fa-icon>
                    <span>ƒêƒÉng nh·∫≠p</span>
                  </a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    routerLink="/account/register"
                    routerLinkActive="active"
                    (click)="collapseNavbar()"
                    data-cy="register"
                  >
                    <fa-icon icon="user-plus" [fixedWidth]="true"></fa-icon>
                    <span>ƒêƒÉng k√Ω</span>
                  </a>
                </li>
              }
            </ul>
          </li>
        </ul>
      </div>

      <a
        class="navbar-toggler d-lg-none"
        href="javascript:void(0);"
        data-toggle="collapse"
        data-target="#navbarResponsive"
        aria-controls="navbarResponsive"
        aria-expanded="false"
        aria-label="Toggle navigation"
        (click)="toggleNavbar()"
      >
        <fa-icon icon="bars"></fa-icon>
      </a>
    </div>
  </div>
  <!-- Notification container -->
  <div id="notification" class="notification hidden" aria-live="polite"></div>
</nav>
