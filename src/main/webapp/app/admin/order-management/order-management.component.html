<div class="order-management-container">
  <h2>Quản lý đơn hàng</h2>

  @if (isLoading()) {
    <p>Đang tải đơn hàng...</p>
  } @else if (orders()?.length === 0) {
    <div class="alert alert-warning">Không có đơn hàng nào.</div>
  } @else {
    <div class="table-responsive">
      <table class="table table-striped" aria-describedby="order-management">
        <thead>
          <tr jhiSort [(sortState)]="sortState" (sortChange)="transition($event)">
            <th scope="col" jhiSortBy="id"><span>ID</span></th>
            <th scope="col" jhiSortBy="orderDate"><span>Ngày đặt</span> <fa-icon icon="sort"></fa-icon></th>
            <th scope="col" jhiSortBy="customerFullName"><span>Tên khách hàng</span></th>
            <th scope="col" jhiSortBy="customerPhone"><span>SĐT khách hàng</span></th>
            <th scope="col" jhiSortBy="totalAmount"><span>Tổng tiền</span></th>
            <th scope="col" jhiSortBy="status"><span>Trạng thái</span></th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          @for (order of orders(); track trackId($index, order)) {
            <tr>
              <td>{{ order.id }}</td>
              <td>{{ formatOrderDate(order.orderDate) }}</td>
              <td>{{ order.customerFullName }}</td>
              <td>{{ order.customerPhone }}</td>
              <td>{{ order.totalAmount | currency: 'VND' : 'symbol' : '1.0-0' }}</td>
              <td>{{ order.status }}</td>
              <td class="text-end">
                <div class="btn-group">
                  <button type="submit" [routerLink]="['/order', order.id]" class="btn btn-info btn-sm">
                    <span class="d-none d-md-inline">Xem chi tiết</span>
                  </button>

                  <!-- Nút cập nhật trạng thái -->
                  @if (order.status === 'PENDING') {
                    <button type="button" (click)="updateStatus(order, 'PROCESSING')" class="btn btn-warning btn-sm">
                      <span class="d-none d-md-inline">Xử lý</span>
                    </button>
                  } @else if (order.status === 'PROCESSING') {
                    <button type="button" (click)="updateStatus(order, 'SHIPPED')" class="btn btn-primary btn-sm">
                      <span class="d-none d-md-inline">Giao hàng</span>
                    </button>
                  } @else if (order.status === 'SHIPPED') {
                    <button type="button" (click)="updateStatus(order, 'DELIVERED')" class="btn btn-success btn-sm">
                      <span class="d-none d-md-inline">Hoàn thành</span>
                    </button>
                  }

                  <!-- Nút hủy đơn hàng (admin có thể hủy bất cứ lúc nào) -->
                  @if (order.status !== 'CANCELLED' && order.status !== 'DELIVERED') {
                    <button type="button" (click)="updateStatus(order, 'CANCELLED')" class="btn btn-danger btn-sm">
                      <span class="d-none d-md-inline">Hủy</span>
                    </button>
                  }
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div>
      <div class="d-flex justify-content-center">
        <jhi-item-count [params]="{ page, totalItems: totalItems(), itemsPerPage }" />
      </div>

      <div class="d-flex justify-content-center">
        <ngb-pagination
          [collectionSize]="totalItems()"
          [(page)]="page"
          [pageSize]="itemsPerPage"
          [maxSize]="5"
          [rotate]="true"
          [boundaryLinks]="true"
          (pageChange)="transition()"
        ></ngb-pagination>
      </div>
    </div>
  }
</div>
