<div>
  <div class="admin-header">
    <h2>
      <span
        id="user-management-page-heading"
        data-cy="userManagementPageHeading"
        >Quản lý người dùng</span
      >

      <div class="d-flex justify-content-end">
        <button
          class="btn btn-info me-2 rounded-pill"
          (click)="loadAll()"
          [disabled]="isLoading()"
        >
          <fa-icon
            icon="sync"
            [animation]="isLoading() ? 'spin' : undefined"
          ></fa-icon>
          <span>Làm mới danh sách</span>
        </button>
        <button
          class="btn btn-primary jh-create-entity rounded-pill"
          [routerLink]="['./new']"
        >
          <fa-icon icon="plus"></fa-icon> <span>Tạo người dùng mới</span>
        </button>
      </div>
    </h2>
  </div>

  <jhi-alert-error />

  <jhi-alert />

  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          placeholder="Tìm kiếm theo tên, email hoặc số điện thoại..."
          [value]="searchTerm()"
          (input)="onSearchInput($event)"
        />
        @if (searchTerm()) {
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="onClearSearch()"
          >
            <fa-icon icon="times"></fa-icon>
          </button>
        }
      </div>
    </div>
  </div>

  @if (filteredUsers() && filteredUsers()!.length > 0) {
    <div class="table-responsive">
      <table
        class="table table-striped table-bordered table-hover"
        aria-describedby="user-management-page-heading"
      >
        <thead>
          <tr jhiSort [(sortState)]="sortState" (sortChange)="loadAll()">
            <th scope="col" jhiSortBy="id">
              <span>ID</span> <fa-icon icon="sort"></fa-icon>
            </th>
            <th scope="col" jhiSortBy="email">
              <span>Email</span> <fa-icon icon="sort"></fa-icon>
            </th>
            <th scope="col" jhiSortBy="firstName">
              <span>Họ và Tên</span> <fa-icon icon="sort"></fa-icon>
            </th>
            <th scope="col" jhiSortBy="activated">
              <span>Trạng thái</span> <fa-icon icon="sort"></fa-icon>
            </th>
            <th scope="col"><span>Vai trò</span></th>
            <th scope="col" jhiSortBy="createdDate">
              <span>Ngày tạo</span> <fa-icon icon="sort"></fa-icon>
            </th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          @for (user of filteredUsers(); track user.id) {
            <tr>
              <td>{{ user.id }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.firstName }} {{ user.lastName }}</td>
              <td>
                @if (user.activated) {
                  <span class="badge bg-success">Hoạt động</span>
                } @else {
                  <span class="badge bg-danger">Đã khóa</span>
                }
              </td>
              <td>
                @for (authority of user.authorities; track $index) {
                  <div>
                    <span class="badge bg-info">{{ authority }}</span>
                  </div>
                }
              </td>
              <td>{{ user.createdDate | date: 'dd/MM/yy HH:mm' }}</td>
              <td class="text-end">
                <div class="btn-group">
                  <button
                    type="button"
                    [routerLink]="['./', user.email, 'view']"
                    class="btn btn-info btn-sm"
                  >
                    <fa-icon icon="eye"></fa-icon>
                    <span class="d-none d-md-inline">Xem</span>
                  </button>

                  <button
                    type="button"
                    [routerLink]="['./', user.email, 'edit']"
                    queryParamsHandling="merge"
                    class="btn btn-primary btn-sm"
                    [disabled]="currentAccount()?.email === user.email"
                  >
                    <fa-icon icon="pencil-alt"></fa-icon>
                    <span class="d-none d-md-inline">Sửa</span>
                  </button>

                  <button
                    type="button"
                    (click)="setActive(user, !user.activated)"
                    class="btn btn-sm"
                    [ngClass]="user.activated ? 'btn-danger' : 'btn-success'"
                    [disabled]="currentAccount()?.email === user.email"
                  >
                    <fa-icon
                      [icon]="user.activated ? 'lock' : 'lock-open'"
                    ></fa-icon>
                    <span class="d-none d-md-inline">{{
                      user.activated ? 'Khóa' : 'Mở khóa'
                    }}</span>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else if (filteredUsers() && filteredUsers()!.length === 0) {
    <div class="alert alert-warning">
      <span>Không có người dùng nào được tìm thấy.</span>
    </div>
  }
  @if (totalItems()) {
    <div class="d-flex justify-content-end mt-3">
      <jhi-item-count
        [params]="{
          page: page,
          totalItems: totalItems(),
          itemsPerPage: itemsPerPage,
        }"
      />
    </div>
    <div class="d-flex justify-content-center">
      <ngb-pagination
        [collectionSize]="totalItems()"
        [(page)]="page"
        [pageSize]="itemsPerPage"
        [maxSize]="5"
        [rotate]="true"
        [boundaryLinks]="true"
        (pageChange)="transition()"
      />
    </div>
  }
</div>
