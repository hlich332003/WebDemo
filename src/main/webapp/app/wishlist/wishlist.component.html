<div class="wishlist-container">
  <div class="wishlist-header">
    <h1 class="page-title">
      <fa-icon icon="heart"></fa-icon>
      <span>Danh sách yêu thích</span>
      @if (wishlistItems$ | async; as products) {
        <span class="count-badge">{{ products.length }}</span>
      }
    </h1>
  </div>

  @if (wishlistItems$ | async; as products) {
    @if (products.length > 0) {
      <div class="products-grid">
        @for (product of products; track product.id) {
          <div class="product-card">
            <div class="product-image-wrapper" (click)="viewProductDetail(product.id!)">
              <img *ngIf="product.imageUrl" [jhiLazyLoad]="getProxiedImageUrl(product.imageUrl)" [alt]="product.name" (error)="onImageError($event)" loading="lazy" />
              <div *ngIf="!product.imageUrl" class="image-placeholder">
                <fa-icon icon="box-open"></fa-icon>
              </div>
            </div>
            <div class="product-info">
              <h5 class="product-name" (click)="viewProductDetail(product.id!)">{{ product.name }}</h5>
              <p class="product-price">{{ formatPrice(product.price) }}</p>
            </div>
            <div class="product-actions">
              <button
                class="btn btn-sm btn-wishlist in-wishlist"
                (click)="removeFromWishlist(product)"
                title="Bỏ thích">
                <fa-icon icon="heart-crack"></fa-icon>
              </button>
              <button
                class="btn btn-sm btn-add-to-cart"
                (click)="addToCart(product)"
                [disabled]="product.quantity === 0"
                title="Thêm vào giỏ hàng">
                <fa-icon icon="shopping-cart"></fa-icon>
              </button>
              <button
                class="btn btn-sm btn-buy-now"
                (click)="buyNow(product)"
                [disabled]="product.quantity === 0">
                {{ product.quantity === 0 ? 'Hết hàng' : 'Mua ngay' }}
              </button>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="empty-wishlist">
        <fa-icon icon="heart-crack"></fa-icon>
        <h2>Danh sách trống</h2>
        <p>Bạn chưa có sản phẩm yêu thích nào. Hãy khám phá cửa hàng nhé!</p>
        <a routerLink="/products" class="btn-primary">
          <fa-icon icon="shopping-cart"></fa-icon>
          <span>Mua sắm ngay</span>
        </a>
      </div>
    }
  } @else {
    <div class="alert alert-info">Đang tải danh sách yêu thích...</div>
  }
</div>
